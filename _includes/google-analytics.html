{% if site.gtag %}
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.gtag }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{{ site.gtag }}', {
    page_title: '{{ page.title | default: site.title }}',
    page_location: '{{ site.url }}{{ page.url }}',
    send_page_view: true
  });

  // Enhanced ecommerce and conversion tracking
  gtag('config', '{{ site.gtag }}', {
    custom_map: {
      'custom_parameter_1': 'page_section',
      'custom_parameter_2': 'user_engagement'
    }
  });

  // Track key interactions for lead generation
  function trackConversion(action, category, label, value) {
    gtag('event', action, {
      event_category: category,
      event_label: label,
      value: value
    });
  }

  // Track form submissions
  function trackFormSubmission(formName) {
    gtag('event', 'form_submit', {
      event_category: 'engagement',
      event_label: formName,
      value: 1
    });
  }

  // Track button clicks
  function trackButtonClick(buttonName, section) {
    gtag('event', 'click', {
      event_category: 'engagement',
      event_label: buttonName,
      custom_parameter_1: section
    });
  }

  // Track scroll depth
  let scrollDepthTracked = false;
  window.addEventListener('scroll', function() {
    if (!scrollDepthTracked && (window.scrollY / document.body.scrollHeight) > 0.75) {
      gtag('event', 'scroll', {
        event_category: 'engagement',
        event_label: '75_percent',
        value: 75
      });
      scrollDepthTracked = true;
    }
  });

  // Track time on page
  let startTime = Date.now();
  window.addEventListener('beforeunload', function() {
    let timeOnPage = Math.round((Date.now() - startTime) / 1000);
    gtag('event', 'timing_complete', {
      name: 'time_on_page',
      value: timeOnPage
    });
  });
</script>
{% else %}
<!-- Fallback Google tag (gtag.js) with hardcoded ID -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-84LK6BBHQB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-84LK6BBHQB');
</script>
{% endif %}